<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Redirecting…</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;margin:32px}</style>
</head>
<body>
  <h3>Opening the app…</h3>
  <p>If it didn’t open automatically, click the button below.</p>
  <button id="open" style="padding:12px 16px;font-size:16px">Open VoltLab</button>

  <script>
    // Берём параметры из #... или ?...
    const raw = location.hash || location.search || "";
    const qs = raw.replace(/^[#?]/, ""); // "access_token=...&type=..."

    const IOS_SCHEME = "ru.sever.ElectricalEngineering";
    const ANDROID_SCHEME = "air.ru.sever.ElectricalEngineering";
    const ANDROID_PACKAGE = "air.ru.sever.ElectricalEngineering";

    // iOS: передаём через fragment (как любит Supabase)
    const hrefIOS = `${IOS_SCHEME}://email-confirm#${qs}`;

    // Android: передаём через query, чтобы Intent не отрезал данные
    const hrefAndroidScheme = `${ANDROID_SCHEME}://email-confirm?${qs}`;
    const hrefAndroidIntent =
      `intent://email-confirm?${qs}` +
      `#Intent;scheme=${ANDROID_SCHEME};package=${ANDROID_PACKAGE};end`;

    const isAndroid = /Android/i.test(navigator.userAgent);

    function openApp() {
      if (isAndroid) {
        // Chrome предпочитает intent://; подстрахуемся схемой через 300 мс
        location.href = hrefAndroidIntent;
        setTimeout(() => { location.href = hrefAndroidScheme; }, 300);
      } else {
        location.href = hrefIOS;
      }
    }

    document.getElementById('open').addEventListener('click', openApp);
    // Автозапуск (может быть проигнорирован без жеста, поэтому есть кнопка)
    setTimeout(openApp, 200);
  </script>
</body>
</html>
